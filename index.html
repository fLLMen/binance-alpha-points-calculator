<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Binance Alpha Points Daily Plan</title>
    <script src="https://cdn.jsdelivr.net/pyodide/v0.25.0/full/pyodide.js"></script>
    <style>
        body {
            font-family: sans-serif;
            line-height: 1.6;
            margin: 20px;
            background-color: #f4f4f4;
            color: #333;
        }
        .container {
            max-width: 700px; /* Wider for more detailed output */
            margin: auto;
            background: #fff;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
        }
        h1 {
            color: #0056b3;
            text-align: center;
            margin-bottom: 20px;
        }
         h2 {
            color: #007bff;
            text-align: center;
            margin-bottom: 15px;
            margin-top: 25px;
        }
        .input-group {
            margin-bottom: 20px;
        }
        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #555;
        }
        .input-group input[type="number"],
        .input-group select {
            width: calc(100% - 18px);
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
            font-size: 1em;
            background-color: #fff;
        }
        button {
            display: block;
            width: 100%;
            padding: 12px;
            background-color: #28a745;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 1.1em;
            cursor: pointer;
            transition: background-color 0.3s ease;
            margin-top: 20px;
        }
        button:hover {
            background-color: #218838;
        }
        #output {
            margin-top: 30px;
            padding: 20px;
            border: 1px solid #c3e6cb;
            border-radius: 4px;
            background-color: #d4edda;
            color: #155724;
            text-align: left;
            font-size: 1em;
            word-break: break-word; /* Prevent overflow */
        }
        #output strong {
             color: #0056b3;
        }
         #output ul {
             padding-left: 20px;
             margin: 15px 0 0 0;
         }
         #output li {
             margin-bottom: 8px;
         }

        #loading {
            text-align: center;
            margin-top: 20px;
            font-style: italic;
            color: #666;
        }
        .note {
            font-size: 0.9em;
            color: #555;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px dashed #eee;
        }
         .rule-explanation {
            font-size: 0.95em;
            color: #333;
            margin-top: 20px;
            padding: 15px;
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
         }
         .rule-explanation strong {
             color: #007bff;
         }
         .warning {
            color: #ff9900;
            margin-top: 15px;
            font-weight: bold;
            padding: 10px;
            background-color: #fff3cd;
            border: 1px solid #ffeeba;
            border-radius: 4px;
        }
         .error {
            color: #dc3545;
            margin-top: 15px;
            font-weight: bold;
            padding: 10px;
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
            border-radius: 4px;
        }
        .output-section {
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid #eee;
        }
        .output-section h4 {
            margin-top: 0;
            margin-bottom: 10px;
            color: #007bff;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Binance Alpha Points Daily Planning</h1>
        <p>Plan your daily Alpha token *purchase* volume based on your expected daily balance tier to reach a specific total Alpha Points goal over a set number of days, minimizing unnecessary volume.</p>

        <div id="loading">Loading calculator...</div>

        <div id="calculator" style="display: none;">
            <h2>Set Your Goal & Conditions</h2>

            <div class="input-group">
                <label for="targetPoints">Target Total Alpha Points (Balance + Volume):</label>
                <input type="number" id="targetPoints" value="75" min="0" step="1">
            </div>

             <div class="input-group">
                <label for="numDays">Number of Trading Days (1-15) for this plan:</label>
                <input type="number" id="numDays" value="15" min="1" max="15" step="1">
            </div>

            <div class="input-group">
                <label for="balanceTierPoints">Expected Consistent Daily Balance Tier:</label>
                <select id="balanceTierPoints">
                    <option value="0">$0 to < $100 (0 points/day)</option>
                    <option value="1">$100 to < $1,000 (1 point/day)</option>
                    <option value="2">$1,000 to < $10,000 (2 points/day)</option>
                    <option value="3">$10,000 to < $100,000 (3 points/day)</option>
                    <option value="4">$100,000 and above (4 points/day)</option>
                </select>
            </div>


            <button id="calculateBtn">Calculate Daily Volume Plan</button>

            <div id="output">
                Enter your goal, days, and balance tier to calculate your daily trading plan.
            </div>
             <div id="message" class="warning" style="display: none;"></div>
             <div id="error" class="error" style="display: none;"></div>

             <div class="rule-explanation">
                 <h2>How Points Are Calculated</h2>
                 <p>Your total points are the sum of Balance Points and Volume Points over the last 15 days.</p>
                 <ul>
                     <li><strong>Balance Points:</strong> Earned daily based on your asset balance tier ($0 to < $100 = 0 pts/day, $100 to < $1k = 1 pt/day, etc.). Total balance points = daily balance points * number of days.</li>
                     <li><strong>Volume Points:</strong> Earned daily based on your *daily* Alpha token purchase volume. The points for a given day (V_daily) are <code>floor(logâ‚‚(V_daily))</code> for V_daily >= $2, and 0 for V_daily < $2. Total volume points = sum of daily volume points over the days.</li>
                 </ul>
                 <p>This calculator helps you figure out the required *daily purchase volume* needed to cover the points your balance *doesn't* earn, aiming for your total goal across the specified number of days. It distributes the required volume points to minimize total volume.</p>
             </div>
        </div>


        <div class="note">
           This calculator assumes you will maintain the selected balance tier *consistently* for each of the specified trading days. It generates a daily purchase volume plan designed to achieve your target total points by earning specific integer volume points each day. This plan is one way to meet the goal with minimal volume and assumes trading occurs on consecutive days starting from "Day 1". You only need to perform the *purchase* volume; selling does not contribute to points. Trading fees are not included.
        </div>
        <div class="note">
            Disclaimer: This is an unofficial calculator based on publicly available information and the explained interpretation of the rules. Actual points calculated by Binance may vary due to specific snapshot times, token eligibility details, trading fees, or other factors not covered here. It serves as an estimation tool only.
        </div>

    </div>

    <script type="text/python">
        # Python code running in Pyodide
        import math

        def calculate_daily_volume_plan(target_total_points, num_days, daily_balance_points):
            """
            Calculates a daily purchase volume plan to reach a total points goal,
            considering points earned from a consistent daily balance tier and minimizing volume.
            Returns a list of tuples: [(day_number, daily_vol_points_needed, min_daily_volume), ...]
            and summary info (total_vol, total_bal_pts, total_achievable_pts).
            """
            if target_total_points < 0 or num_days <= 0 or daily_balance_points < 0:
                # Invalid input, handled by JS validation
                return ([], 0, 0, 0) # daily_plan, total_vol, total_bal_pts, total_achievable_pts

            # 1. Calculate points earned from balance over the period
            total_balance_points = daily_balance_points * num_days

            # 2. Calculate remaining points needed from volume trading
            remaining_volume_points_needed = target_total_points - total_balance_points

            daily_plan = []
            required_total_volume_for_volume = 0
            achievable_volume_points_sum = 0 # Track actual volume points earned by the plan

            if remaining_volume_points_needed <= 0:
                # Balance points already meet or exceed the target. No volume points needed.
                # Plan is 0 volume each day.
                for day in range(1, num_days + 1):
                     daily_plan.append((day, 0, 0.00)) # Day #, Vol Points Needed, Min Volume

            else:
                # 3. Distribute remaining volume points needed across days
                # We want to assign points such that we use the lowest possible volume tiers.
                # Calculate base points and extra points needed per day
                points_base_per_day = remaining_volume_points_needed // num_days # Integer division
                extra_point_days_count = remaining_volume_points_needed % num_days # Remainder

                # Create a list of daily point targets
                daily_point_targets = []
                for _ in range(extra_point_days_count):
                    daily_point_targets.append(points_base_per_day + 1)
                for _ in range(num_days - extra_point_days_count):
                     daily_point_targets.append(points_base_per_day)

                # Optional: Sort daily_point_targets descending if you want higher volume days first in the list
                # daily_point_targets.sort(reverse=True)

                # 4. Create the daily plan based on calculated daily point targets
                for day_index in range(num_days):
                    day_number = day_index + 1
                    daily_vol_points = daily_point_targets[day_index]

                    # Calculate minimum daily volume needed for this many points
                    if daily_vol_points <= 0:
                         # To get 0 volume points daily, volume must be less than $2. Minimum needed is $0.00.
                         min_daily_volume = 0.00
                    else:
                         # To get P points (P>=1) daily from volume, you need Daily Volume >= 2^P
                         min_daily_volume = math.pow(2, daily_vol_points)

                    daily_plan.append((day_number, daily_vol_points, min_daily_volume))
                    required_total_volume_for_volume += min_daily_volume
                    achievable_volume_points_sum += daily_vol_points # Sum the actual points earned per day in the plan


            # 5. Calculate total achievable points
            total_achievable_points = total_balance_points + achievable_volume_points_sum


            return (daily_plan, required_total_volume_for_volume, total_balance_points, total_achievable_points)

    </script>

    <script type="text/javascript">
        let pyodide;
        // No need to declare math here if using JS Math.pow

        async function loadPyodideAndRun() {
            // Show loading message, hide calculator
            document.getElementById('loading').style.display = 'block';
            document.getElementById('calculator').style.display = 'none';

            try {
                pyodide = await loadPyodide();

                // Access the Python script embedded in the HTML
                const pythonScript = document.querySelector('script[type="text/python"]').textContent;
                await pyodide.runPythonAsync(pythonScript);

                // No need to pyimport math if only using Math.pow in JS

                // Hide loading, show calculator
                document.getElementById('loading').style.display = 'none';
                document.getElementById('calculator').style.display = 'block';

                console.log("Pyodide and Python script loaded.");

            } catch (e) {
                 document.getElementById('loading').textContent = 'Failed to load calculator.';
                 document.getElementById('error').textContent = `Error loading calculator: ${e}`;
                 document.getElementById('error').style.display = 'block';
                 console.error("Error loading Pyodide or script:", e);
            }
        }

        document.getElementById('calculateBtn').addEventListener('click', async () => {
            // FIX: Corrected typo documentgetElementById -> document.getElementById
            const targetPointsInput = document.getElementById('targetPoints');
            const numDaysInput = document.getElementById('numDays');
            const balanceTierPointsSelect = document.getElementById('balanceTierPoints');

            const outputDiv = document.getElementById('output');
            const errorDiv = document.getElementById('error');
            const messageDiv = document.getElementById('message');

            errorDiv.style.display = 'none'; // Hide previous errors
            errorDiv.textContent = '';
            messageDiv.style.display = 'none'; // Hide previous messages
            messageDiv.textContent = '';
            outputDiv.innerHTML = 'Calculating...'; // Show thinking state

            const targetTotalPoints = parseInt(targetPointsInput.value);
            const numDays = parseInt(numDaysInput.value);
            const dailyBalancePoints = parseInt(balanceTierPointsSelect.value);

            // --- Input Validation ---
            if (isNaN(targetTotalPoints) || targetTotalPoints < 0) {
                errorDiv.textContent = "Please enter a valid non-negative whole number for Target Total Points.";
                errorDiv.style.display = 'block';
                outputDiv.innerHTML = 'Enter your goal, days, and balance tier to calculate your daily trading plan.';
                return;
            }

            if (isNaN(numDays) || numDays < 1 || numDays > 15) {
                errorDiv.textContent = "Please enter a valid number of trading days between 1 and 15.";
                errorDiv.style.display = 'block';
                 outputDiv.innerHTML = 'Enter your goal, days, and balance tier to calculate your daily trading plan.';
                return;
            }

            if (isNaN(dailyBalancePoints) || dailyBalancePoints < 0 || dailyBalancePoints > 4) {
                 errorDiv.textContent = "Invalid balance tier selected.";
                 errorDiv.style.display = 'block';
                 outputDiv.innerHTML = 'Enter your goal, days, and balance tier to calculate your daily trading plan.';
                 return;
            }
             // --- End Validation ---


            // Call the Python function
            try {
                 const result = pyodide.globals.get('calculate_daily_volume_plan')(targetTotalPoints, numDays, dailyBalancePoints);
                 const dailyPlan = result[0]; // List of (day, vol_pts, volume)
                 const requiredTotalVolumeForVolume = result[1];
                 const totalBalancePoints = result[2];
                 const totalAchievablePoints = result[3];


                 let outputHtml = `<h3>Plan Summary</h3>`;
                 outputHtml += `<ul>`;
                 outputHtml += `<li>Target Total Points: <strong>${targetTotalPoints}</strong></li>`;
                 outputHtml += `<li>Planning Period: <strong>${numDays} days</strong></li>`;
                 outputHtml += `<li>Expected Consistent Daily Balance Tier: <strong>${dailyBalancePoints} points/day</strong></li>`;
                 outputHtml += `<li>Points earned from Balance over ${numDays} days: <strong>${totalBalancePoints}</strong></li>`;
                 outputHtml += `</ul>`;

                 const remainingVolumePointsNeeded = targetTotalPoints - totalBalancePoints;

                 if (remainingVolumePointsNeeded <= 0) {
                     outputHtml += `<div class="output-section">`;
                     outputHtml += `<h4>Volume Trading Required: None</h4>`;
                     outputHtml += `<p>Your expected balance points (${totalBalancePoints}) already meet or exceed your target total points (${targetTotalPoints}).</p>`;
                     outputHtml += `<p>Minimum Daily Purchase Volume Guideline: <strong>$0.00</strong></p>`;
                     outputHtml += `<p>Resulting Total Purchase Volume over ${numDays} days: <strong>$0.00</strong></p>`;
                     outputHtml += `</div>`;
                     outputHtml += `<p>Total Estimated Achievable Points: <strong>${totalAchievablePoints}</strong></p>`;

                     if (totalAchievablePoints > targetTotalPoints) {
                          messageDiv.textContent = `Note: Your expected balance points alone (${totalBalancePoints}) exceed your target (${targetTotalPoints}). The estimated total achievable points are ${totalAchievablePoints}.`;
                          messageDiv.style.display = 'block';
                     }

                 } else {
                     outputHtml += `<div class="output-section">`;
                     outputHtml += `<h4>Daily Volume Trading Plan (to earn ${remainingVolumePointsNeeded} Volume Points)</h4>`;

                     // Group plan by required daily volume points and volume for cleaner output
                     const planGroups = dailyPlan.reduce((acc, [day, vol_pts, volume]) => {
                         // Use volume.toFixed(2) in key to group identical volumes precisely
                         const key = `${vol_pts}_${volume.toFixed(2)}`;
                         if (!acc[key]) {
                             acc[key] = { vol_pts: vol_pts, volume: volume, days: [] };
                         }
                         acc[key].days.push(day);
                         return acc;
                     }, {});

                     outputHtml += `<ul>`;
                     // Sort groups by daily points descending, then volume descending
                     Object.values(planGroups).sort((a, b) => b.vol_pts - a.vol_pts || b.volume - a.volume).forEach(group => {
                         const daysList = group.days.join(', ');
                         if (group.vol_pts === 0) {
                             outputHtml += `<li>On Day(s) ${daysList}: Target <strong>0 Volume Points</strong> (requires daily purchase volume less than $2). Minimum daily purchase volume: <strong>${group.volume.toFixed(2)} USD</strong>.</li>`;
                         } else {
                              // Use standard JavaScript Math.pow here
                              outputHtml += `<li>On Day(s) ${daysList}: Target <strong>${group.vol_pts} Volume Points</strong> (requires daily purchase volume of at least $${Math.pow(2, group.vol_pts).toFixed(2)}). Minimum daily purchase volume: <strong>${group.volume.toFixed(2)} USD</strong>.</li>`;
                         }
                     });
                     outputHtml += `</ul>`;

                     outputHtml += `<p>Minimum Total Purchase Volume over ${numDays} days: <strong>${requiredTotalVolumeForVolume.toFixed(2)} USD</strong></p>`;
                     outputHtml += `</div>`; // End output-section

                     outputHtml += `<p>Total Estimated Achievable Points (Balance + Volume): <strong>${totalAchievablePoints}</strong></p>`;


                    // Achievable total points *should* exactly match target if remaining > 0, due to how plan is built
                    // The only time totalAchievablePoints > targetTotalPoints is if totalBalancePoints > targetTotalPoints
                    if (totalBalancePoints > targetTotalPoints) {
                         messageDiv.textContent = `Note: Your expected balance points alone (${totalBalancePoints}) meet or exceed your target (${targetTotalPoints}). No volume trading was required. The estimated total achievable points are ${totalAchievablePoints}.`;
                         messageDiv.style.display = 'block';
                    } else if (totalAchievablePoints < targetTotalPoints) {
                          // This would indicate a logic error if remaining_volume_points_needed was positive
                         errorDiv.textContent += (errorDiv.textContent ? "\n" : "") + `Internal Error: Achievable total points (${totalAchievablePoints}) are less than the target (${targetTotalPoints}) even after calculating the required volume plan. Please check inputs.`;
                         errorDiv.style.display = 'block';
                    }


                    if (requiredTotalVolumeForVolume > 50000 || dailyPlan.some(day => day[2] > 20000)) { // Warn for large volumes, adjusted daily threshold
                         messageDiv.textContent += (messageDiv.textContent ? "\n" : "") + "Note: The required purchase volume (daily or total) is substantial. Ensure you have sufficient capital, consider trading fees, and manage risk.";
                         messageDiv.style.display = 'block';
                    }
                 }

                 outputDiv.innerHTML = outputHtml;


            } catch (e) {
                 errorDiv.textContent = `Calculation error: ${e}`;
                 errorDiv.style.display = 'block';
                 outputDiv.innerHTML = 'Enter your goal, days, and balance tier to calculate your daily trading plan.';
                 console.error("Calculation error:", e);
            }
        });

        // Load Pyodide when the page loads
        loadPyodideAndRun();

    </script>
</body>
</html>